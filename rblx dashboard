<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Roblox Player Counts Dashboard</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background:#f8f8f8; }
    h1 { margin-bottom: 10px; }
    table { border-collapse: collapse; width: 400px; background:white; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align:left; }
    th { background:#eee; }
    .ts { color:#666; font-size:12px; }
  </style>
</head>
<body>
  <h1>Player Counts</h1>
  <div>Auto-refresh every 5s â€¢ <button id="refreshBtn">Refresh now</button></div>
  <div id="lastUpdate" class="ts"></div>
  <table id="countsTable">
    <thead><tr><th>Place ID</th><th>Players</th><th>Last seen</th></tr></thead>
    <tbody></tbody>
  </table>

  <script>
    const API_URL = "PASTE_YOUR_APPS_SCRIPT_WEBAPP_URL_HERE"; // same web app URL (GET returns JSON)
    const REFRESH_MS = 5000;
    const tbody = document.querySelector("#countsTable tbody");
    const lastUpdate = document.getElementById("lastUpdate");

    async function fetchCounts() {
      try {
        const r = await fetch(API_URL);
        const data = await r.json(); // expected array [{placeId, playerCount, timestamp},...]
        render(data);
      } catch (err) {
        console.error("Fetch error:", err);
        lastUpdate.textContent = "Error fetching data: " + err.toString();
      }
    }

    function render(data) {
      // Sort descending by playerCount
      data.sort((a,b) => (b.playerCount || 0) - (a.playerCount || 0));
      tbody.innerHTML = "";
      data.forEach(row => {
        const tr = document.createElement("tr");
        const t1 = document.createElement("td");
        t1.textContent = row.placeId || "(unknown)";
        const t2 = document.createElement("td");
        t2.textContent = row.playerCount != null ? row.playerCount : "-";
        const t3 = document.createElement("td");
        t3.textContent = row.timestamp ? new Date(row.timestamp).toLocaleString() : "-";
        tr.appendChild(t1); tr.appendChild(t2); tr.appendChild(t3);
        tbody.appendChild(tr);
      });
      lastUpdate.textContent = "Last refresh: " + new Date().toLocaleString();
    }

    document.getElementById("refreshBtn").addEventListener("click", fetchCounts);

    // initial fetch + periodic
    fetchCounts();
    setInterval(fetchCounts, REFRESH_MS);
  </script>
</body>
</html>
